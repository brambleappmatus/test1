(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{6300:function(e,t,r){Promise.resolve().then(r.bind(r,50021))},97745:function(e,t,r){"use strict";r.d(t,{Ay:function(){return n},Bj:function(){return d},mF:function(){return o},m_:function(){return a},r6:function(){return i}});var s=r(88282);async function a(e){let{data:t,error:r}=await s.O.from("workout_exercises").select("\n      *,\n      exercise:exercises(*)\n    ").eq("workout_id",e).order("order_index",{ascending:!0});if(r)throw Error(r.message);let a=await Promise.all(t.map(async e=>{let{data:t}=await s.O.from("workout_exercises").select("\n          weight,\n          created_at,\n          archived_workout_id\n        ").eq("exercise_id",e.exercise_id).is("archived_workout_id","not.null").order("created_at",{ascending:!1}).limit(1);return t&&t.length>0?{...e,previous_weight:t[0].weight,last_used_at:t[0].created_at}:e}));return a||[]}async function i(e){let{data:t}=await s.O.from("workout_exercises").select("order_index").eq("workout_id",e.workout_id).order("order_index",{ascending:!1}).limit(1),r=t&&t.length>0?(t[0].order_index||0)+1:0,{data:a,error:i}=await s.O.from("workout_exercises").insert([{...e,order_index:r}]).select("\n      *,\n      exercise:exercises(*)\n    ").single();if(i)throw Error(i.message);return a}async function o(e,t){let{data:r,error:a}=await s.O.from("workout_exercises").update(t).eq("id",e).select("\n      *,\n      exercise:exercises(*)\n    ").single();if(a)throw Error(a.message);return r}async function n(e,t){let r=t.map((e,t)=>({id:e,order_index:t}));for(let e of r){let{error:t}=await s.O.from("workout_exercises").update({order_index:e.order_index}).eq("id",e.id);if(t)throw Error("Failed to update order for exercise ".concat(e.id,": ").concat(t.message))}}async function d(e){let{error:t}=await s.O.from("workout_exercises").delete().eq("id",e);if(t)throw Error(t.message);let{data:r,error:a}=await s.O.from("workout_exercises").select("id").order("order_index",{ascending:!0});if(a)throw Error("Failed to fetch remaining exercises: ".concat(a.message));await n(e,r.map(e=>e.id))}},49918:function(e,t,r){"use strict";r.d(t,{c6:function(){return o},nZ:function(){return i},s2:function(){return a}});var s=r(88282);async function a(){let{data:e,error:t}=await s.O.from("archived_workouts").select("\n      *,\n      workout_exercises (\n        *,\n        exercise:exercises(*)\n      )\n    ").order("date",{ascending:!1});if(t)throw console.error("Error fetching workout history:",t),Error("Failed to fetch workout history");return e||[]}async function i(e){let{error:t}=await s.O.from("archived_workouts").delete().eq("id",e);if(t)throw console.error("Error deleting archived workout:",t),Error("Failed to delete workout")}async function o(e,t,r){let{data:a,error:i}=await s.O.from("archived_workouts").insert([{workout_template_id:e.id,name:e.name,score:r,date:new Date().toISOString()}]).select().single();if(i)throw console.error("Error archiving workout:",i),Error("Failed to archive workout");let o=t.map(e=>({archived_workout_id:a.id,exercise_id:e.exercise_id,sets:e.sets,reps:e.reps,weight:e.weight})),{error:n}=await s.O.from("workout_exercises").insert(o);if(n)throw console.error("Error saving workout exercises:",n),await s.O.from("archived_workouts").delete().eq("id",a.id),Error("Failed to save workout exercises");return a}},21779:function(e,t,r){"use strict";r.d(t,{Ti:function(){return o},cc:function(){return a},ne:function(){return n},xQ:function(){return i}});var s=r(88282);async function a(){let{data:e,error:t}=await s.O.from("workouts").select("*").order("date",{ascending:!1});if(t)throw Error(t.message);return e||[]}async function i(e){let{data:t,error:r}=await s.O.from("workouts").insert([{name:e}]).select().single();if(r)throw Error(r.message);return t}async function o(e,t){let{data:r,error:a}=await s.O.from("workouts").update({name:t}).eq("id",e).select().single();if(a)throw Error(a.message);return r}async function n(e){let{error:t}=await s.O.from("workouts").delete().eq("id",e);if(t)throw Error(t.message)}},88282:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var s=r(54566);let a=(0,s.eI)("https://imtezydkgjsusioutche.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltdGV6eWRrZ2pzdXNpb3V0Y2hlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMyOTY4MDcsImV4cCI6MjA0ODg3MjgwN30.89sOaYqjJXHk1KMlXnvZJSsEBoQ_iopj4kfytc2Rm-Y")},50021:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var s=r(57437),a=r(2265),i=r(24033),o=r(21779),n=r(97745),d=r(49918);function l(e){let{workouts:t,selectedWorkout:r,onSelect:i}=e,[o,n]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>n(!o),className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-lg hover:border-emerald-500 dark:hover:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200",children:[(0,s.jsx)("div",{className:"flex items-center",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-gray-900 dark:text-white font-medium",children:r.name}),(0,s.jsx)("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:new Date(r.date).toLocaleDateString()})]}):(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Select a workout"})}),(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(o?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),(0,s.jsx)("div",{className:"absolute z-20 w-full mt-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-800 rounded-lg shadow-lg overflow-hidden",children:(0,s.jsx)("div",{className:"max-h-60 overflow-auto",children:0===t.length?(0,s.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No workouts available"}):t.map(e=>(0,s.jsxs)("button",{onClick:()=>{i(e),n(!1)},className:"w-full text-left px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors ".concat((null==r?void 0:r.id)===e.id?"bg-emerald-50 dark:bg-emerald-900/20":""),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.date).toLocaleDateString()})]},e.id))})})]})]})}function c(e){var t,r,i;let{workoutExercises:o,onError:d,onExerciseUpdate:l}=e,[c,u]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=Object.fromEntries(o.map(e=>{var t,r,s;return[e.id,{sets:e.sets||(null===(t=e.exercise)||void 0===t?void 0:t.default_sets)||3,reps:e.reps||(null===(r=e.exercise)||void 0===r?void 0:r.default_reps)||10,weight:e.weight||(null===(s=e.exercise)||void 0===s?void 0:s.default_weight)||20,previousWeight:e.previous_weight,lastUsedAt:e.last_used_at,isUpdated:!1}]}));u(e)},[o]),(0,a.useEffect)(()=>{let e=o.map(e=>{var t,r,s;return{...e,sets:(null===(t=c[e.id])||void 0===t?void 0:t.sets)||e.sets,reps:(null===(r=c[e.id])||void 0===r?void 0:r.reps)||e.reps,weight:(null===(s=c[e.id])||void 0===s?void 0:s.weight)||e.weight}});l(e)},[c,o,l]);let m=async e=>{try{let t=c[e];await (0,n.mF)(e,{sets:t.sets,reps:t.reps,weight:t.weight}),u(r=>({...r,[e]:{...r[e],isUpdated:!0,previousWeight:t.weight,lastUsedAt:new Date().toISOString()}})),d(null),setTimeout(()=>{u(t=>({...t,[e]:{...t[e],isUpdated:!1}}))},2e3)}catch(e){d("Failed to update exercise")}},x=e=>"number"!=typeof e?0:Math.round((e+2.5)*2)/2;return(0,s.jsx)("div",{className:"space-y-4",children:o.map(e=>{var a,o,n,d,l,g,h;return(0,s.jsx)("div",{className:"group bg-gray-50 dark:bg-gray-900/50 rounded-lg sm:rounded-xl p-4 sm:p-6 transition-all duration-200 hover:shadow-md",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 dark:text-white",children:null===(a=e.exercise)||void 0===a?void 0:a.name}),(0,s.jsx)("button",{onClick:()=>m(e.id),className:"px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg text-sm font-medium transition-all duration-200 ".concat((null===(o=c[e.id])||void 0===o?void 0:o.isUpdated)?"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300":"bg-emerald-600 hover:bg-emerald-700 text-white"),children:(null===(n=c[e.id])||void 0===n?void 0:n.isUpdated)?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Saved"]}):"Save"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sets"}),(0,s.jsx)("input",{type:"number",min:"1",value:null!==(t=null===(d=c[e.id])||void 0===d?void 0:d.sets)&&void 0!==t?t:"",onChange:t=>u(r=>({...r,[e.id]:{...r[e.id],sets:parseInt(t.target.value)||0}})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-colors text-sm"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:"Reps"}),(0,s.jsx)("input",{type:"number",min:"1",value:null!==(r=null===(l=c[e.id])||void 0===l?void 0:l.reps)&&void 0!==r?r:"",onChange:t=>u(r=>({...r,[e.id]:{...r[e.id],reps:parseInt(t.target.value)||0}})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-colors text-sm"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300",children:"Weight"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.5",value:null!==(i=null===(g=c[e.id])||void 0===g?void 0:g.weight)&&void 0!==i?i:"",onChange:t=>u(r=>({...r,[e.id]:{...r[e.id],weight:parseFloat(t.target.value)||0}})),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-colors text-sm"})]})]}),(null===(h=c[e.id])||void 0===h?void 0:h.previousWeight)&&(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-xs sm:text-sm",children:[(0,s.jsxs)("div",{className:"text-gray-600 dark:text-gray-400",children:["Previous: ",c[e.id].previousWeight,"kg",c[e.id].lastUsedAt&&(0,s.jsxs)("span",{className:"ml-1 text-gray-500",children:["(",new Date(c[e.id].lastUsedAt).toLocaleDateString(),")"]})]}),(0,s.jsxs)("div",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["Suggested: ",x(c[e.id].previousWeight),"kg"]})]})]})},e.id)})})}function u(e){let{isOpen:t,onConfirm:r,onCancel:i}=e,[o,n]=(0,a.useState)(!1),[d,l]=(0,a.useState)(3);if(!t)return null;let c=async e=>{e.preventDefault(),n(!0);try{await r(d)}finally{n(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white dark:bg-dark-bg rounded-lg w-full max-w-md shadow-xl border border-gray-200 dark:border-gray-800",children:(0,s.jsxs)("form",{onSubmit:c,className:"p-6 space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"How was your workout?"}),(0,s.jsx)("div",{className:"flex justify-between items-center px-4",children:["\uD83D\uDE2B","\uD83D\uDE15","\uD83D\uDE10","\uD83D\uDE42","\uD83E\uDD29"].map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:()=>l(t+1),className:"text-4xl transition-transform ".concat(d===t+1?"transform scale-125":"opacity-50 hover:opacity-75"),children:e},t))}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:i,disabled:o,className:"px-4 py-2 text-sm font-medium bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium bg-black dark:bg-white text-white dark:text-black rounded-lg hover:bg-black/90 dark:hover:bg-white/90 disabled:opacity-50",children:o?"Completing...":"Complete Workout"})]})]})})})}function m(){let e=(0,i.useRouter)(),[t,r]=(0,a.useState)([]),[m,x]=(0,a.useState)(null),[g,h]=(0,a.useState)([]),[f,w]=(0,a.useState)(!0),[k,p]=(0,a.useState)(null),[v,y]=(0,a.useState)(!1),[b,j]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async function(){try{let e=await (0,o.cc)();r(e)}catch(e){p("Failed to fetch workouts")}finally{w(!1)}})()},[]),(0,a.useEffect)(()=>{m?async function(){try{let e=await (0,n.m_)(m.id);h(e),j(e)}catch(e){p("Failed to fetch workout exercises")}}():(h([]),j([]))},[m]);let N=async t=>{if(m)try{await (0,d.c6)(m,b,t),e.push("/history")}catch(e){p("Failed to finish workout"),y(!1)}};return f?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black dark:border-white"})}):(0,s.jsxs)("div",{className:"space-y-6 sm:space-y-8 max-w-3xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:"Log Workout"}),(0,s.jsx)("p",{className:"mt-1 sm:mt-2 text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Track your progress and record your achievements"})]}),m&&g.length>0&&(0,s.jsxs)("button",{onClick:()=>y(!0),className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 rounded-md bg-black dark:bg-white text-white dark:text-black font-medium shadow-sm hover:bg-black/90 dark:hover:bg-white/90 focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white focus:ring-offset-2 dark:focus:ring-offset-black transition-colors",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Finish Workout"]})]}),(0,s.jsx)("div",{className:"bg-white dark:bg-black rounded-md shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden",children:(0,s.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Select Workout"}),(0,s.jsx)(l,{workouts:t,selectedWorkout:m,onSelect:x})]}),m?(0,s.jsxs)("div",{className:"mt-6 sm:mt-8",children:[(0,s.jsx)("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Exercise Progress"}),(0,s.jsx)(c,{workoutExercises:g,onError:p,onExerciseUpdate:j})]}):(0,s.jsxs)("div",{className:"text-center py-8 sm:py-12",children:[(0,s.jsx)("svg",{className:"mx-auto h-10 w-10 sm:h-12 sm:w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No workout selected"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Choose a workout to start logging your progress."})]}),k&&(0,s.jsxs)("div",{className:"mt-4 p-3 sm:p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-md text-sm flex items-start",children:[(0,s.jsx)("svg",{className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),k]})]})}),(0,s.jsx)(u,{isOpen:v,onConfirm:N,onCancel:()=>y(!1)})]})}},24033:function(e,t,r){e.exports=r(20290)}},function(e){e.O(0,[382,971,864,744],function(){return e(e.s=6300)}),_N_E=e.O()}]);